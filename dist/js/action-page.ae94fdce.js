/*!
 * ERSS SAYING
 * (c) 2020-2021 Xhemj
 * Build: 2021-7-31 11:38:07
 * Version: 3.1.0
 * ====
 * o(〃＾▽＾〃)o
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["action-page"],{1102:function(t,e,n){},"1ceb":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"my--submit-app"},[n("div",{staticClass:"my--submit"},[n("h1",[t._v("名言投稿")]),n("a-form-model",{ref:"ruleForm",attrs:{model:t.form,rules:t.rules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[n("a-form-model-item",{ref:"name",attrs:{label:"昵称",prop:"name"}},[n("a-input",{attrs:{placeholder:"选填"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),n("a-form-model-item",{ref:"school",attrs:{label:"学校",prop:"school"}},[n("a-input",{attrs:{placeholder:"选填"},model:{value:t.form.school,callback:function(e){t.$set(t.form,"school",e)},expression:"form.school"}})],1),n("a-form-model-item",{ref:"classname",attrs:{label:"班级",prop:"classname"}},[n("a-input",{attrs:{placeholder:"选填"},model:{value:t.form.classname,callback:function(e){t.$set(t.form,"classname",e)},expression:"form.classname"}})],1),n("a-form-model-item",{ref:"mail",attrs:{label:"邮箱",prop:"mail"}},[n("a-input",{attrs:{pattern:"^[a-z0-9]+([._\\\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$",placeholder:"选填，若您的名言被入选，我们将会第一时间联系您"},model:{value:t.form.mail,callback:function(e){t.$set(t.form,"mail",e)},expression:"form.mail"}})],1),n("a-form-model-item",{ref:"saying",attrs:{label:"名言",prop:"saying"}},[n("a-input",{attrs:{placeholder:"格式：教师名 + 名言"},model:{value:t.form.saying,callback:function(e){t.$set(t.form,"saying",e)},expression:"form.saying"}})],1),n("a-form-model-item",{ref:"story",attrs:{label:"名言故事",prop:"story"}},[n("a-input",{attrs:{type:"textarea",rows:"10",placeholder:"选填，有机会选入ERSS名言微信公众号哦！"},model:{value:t.form.story,callback:function(e){t.$set(t.form,"story",e)},expression:"form.story"}})],1),n("a-form-model-item",{attrs:{"wrapper-col":{span:14,offset:4}}},[n("a-button",{staticClass:"submit_btn",attrs:{type:"primary",loading:t.isLoadingSubmit},on:{click:t.onSubmit}},[t._v(" 提交 ")]),n("a-button",{staticStyle:{"margin-left":"10px"},on:{click:t.resetForm}},[t._v(" 清空 ")])],1)],1)],1),n("MYFooter",{attrs:{mode:"back"}})],1)},r=[],i=(n("a73a"),n("3d83"),n("8d24"),n("1de4")),o=n.n(i),c=n("6a79"),s=n("1b2a"),m=n("a6b2"),u={name:"MYSubmit",data:function(){return{labelCol:{span:4},wrapperCol:{span:20},isLoadingSubmit:!1,isSubmit:!1,form:{name:"",school:"",classname:"",mail:"",saying:"",story:""},rules:{name:[{required:!0,message:"请输入昵称"}],school:[{required:!1}],classname:[{required:!1}],mail:[{required:!1}],saying:[{required:!0,message:"请输入名言"}],story:[{required:!1}]}}},components:{MYFooter:m["a"]},mounted:function(){Object(c["e"])(".my--submit")},methods:{resetForm:function(){this.$refs.ruleForm.resetFields()},onSubmit:function(){var t=this;this.$refs.ruleForm.validate((function(e){e?(t.isLoadingSubmit=!0,fetch(s["b"].submit,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:"mingyan-contribute",data:{my:t.form.saying,name:t.form.name,story:t.form.story,class:t.form.classname,school:t.form.school,mail:t.form.mail,t:(new Date).getTime()}})}).then((function(){t.isLoadingSubmit=!1,o()({title:"名言投稿成功！",text:"名言："+t.form.saying+"\n请等待审核",icon:"success",button:"关闭",closeOnClickOutside:!1}).then((function(){location.href="./?from=mingyan-contribute"}))}))["catch"]((function(){c["a"].err("提交失败，建议稍后再试")}))):c["a"].err("提交失败，请检查填写的内容是否符合规则")}))}}},l=u,f=(n("542d"),n("863b"),n("4ac2")),d=Object(f["a"])(l,a,r,!1,null,"4d49e0bb",null);e["default"]=d.exports},2789:function(t,e,n){},"542d":function(t,e,n){"use strict";n("1102")},5826:function(t,e,n){"use strict";n("776a")},"671f":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"my--ranking-app"},[n("div",{staticClass:"my--ranking"},[t.isFinishLoading?n("div",{staticClass:"my--ranking-finish-loading"},[n("h1",{staticStyle:{"text-align":"center"}},[t._v("排行榜")]),t._l(t.rankingData,(function(e,a){return n("a-row",{key:a+e,staticClass:"my--ranking-item"},[n("a-col",{attrs:{span:t.width[0],id:"star-ranking-num"}},[n("router-link",{attrs:{to:"/@"+t.findMingyan(e.text)}},[t._v(" "+t._s(new Number(a)+1)+" ")])],1),n("a-col",{staticClass:"my--star-ranking-text",attrs:{span:t.width[1],id:"star-ranking-text"}},[n("router-link",{attrs:{to:"/@"+t.findMingyan(e.text)}},[t._v(" "+t._s(e.text)+" ")])],1),n("a-col",{attrs:{span:t.width[2]}},[n("router-link",{attrs:{to:"/@"+t.findMingyan(e.text)}},[n("i",{staticClass:"mdui-icon material-icons",staticStyle:{color:"rgba(0, 0, 0, 0.64)"},attrs:{id:"star-ranking-thumb"}},[t._v("")])]),n("span",{attrs:{id:"star-ranking-thumb-num"}},[n("router-link",{attrs:{to:"/@"+t.findMingyan(e.text)}},[t._v(" "+t._s(e.num)+" ")])],1)],1)],1)}))],2):n("div",{staticClass:"my--ranking-loading-tip"},[t._m(0),n("br")])]),n("MYFooter",{attrs:{mode:"back"}})],1)},r=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("strong",[n("div",[n("h1",[t._v("加载中……")])])])}],i=n("a6b2"),o=n("f561"),c=n("6a79"),s=n("7cc4"),m={name:"MYRanking",components:{MYFooter:i["a"]},data:function(){return{isFinishLoading:!1,rankingData:[]}},computed:{width:function(){return Object(c["d"])()?[4,14,6]:[4,16,4]}},mounted:function(){Object(c["e"])(".my--ranking"),this.getRankingData()},methods:{getRankingData:function(){var t=this;o["a"].getRanking().then((function(e){t.rankingData=e.data,t.isFinishLoading=!0}))},findMingyan:function(t){for(var e in s["d"])if(s["d"][e]===t)return e;return 0}}},u=m,l=(n("5826"),n("4ac2")),f=Object(l["a"])(u,a,r,!1,null,"62b972ba",null);e["default"]=f.exports},"776a":function(t,e,n){},"863b":function(t,e,n){"use strict";n("2789")},f561:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var a=n("dc45"),r=n("7e2d"),i=(n("e186"),n("a73a"),n("b0db"),n("8d24"),n("1b2a")),o=n("6a79");Object(o["j"])("https://recaptcha.net/recaptcha/api.js?onload=grecaptchaready&render=6LdOb_gaAAAAAAIQpvSd_6a5yjeneoVlvM159zwH",{async:!0,defer:!0});var c=!1,s=function(){Object(o["k"])("人机验证加载成功！"),c=!0};window["grecaptchaready"]=s;var m=function(){return new Promise((function(t,e){c||e("人机验证正在加载中，请稍后再试"),window.grecaptcha.execute(i["e"],{action:"addstar"}).then((function(e){t(e)}))}))},u=i["b"].star_v2,l={getNum:function(t){if(Promise)return t||(t=document.querySelector(".my--mingyan-name").innerText.trim()+"："+document.querySelector(".my--mingyan-text").innerText.trim()),new Promise((function(e,n){fetch(u,Object(r["a"])(Object(r["a"])({},i["c"]),{},{body:JSON.stringify({event:"getnum",data:{MY_text:t,MY_token:Object(o["f"])(),t:(new Date).getTime()}})})).then((function(t){return t.json()})).then((function(t){e(t)}))["catch"]((function(t){n(t)}))}))},addStar:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(e,n){var a,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(Promise){t.next=2;break}return t.abrupt("return");case 2:return e||n||(e=document.querySelector(".my--mingyan-name").innerText.trim()+"："+document.querySelector(".my--mingyan-text").innerText.trim()),a={},n&&e&&(a={MY_text:e}),n&&!e&&(a={MY_ID:n}),!n&&e&&(a={MY_text:e}),t.prev=7,t.next=10,m();case 10:return c=t.sent,t.abrupt("return",new Promise((function(t,e){fetch(u,Object(r["a"])(Object(r["a"])({},i["c"]),{},{body:JSON.stringify({event:"addstar",data:Object(r["a"])(Object(r["a"])({},a),{},{MY_token:Object(o["f"])(),re_token:c,t:(new Date).getTime()})})})).then((function(t){return t.json()})).then((function(e){t(e)}))["catch"]((function(t){e(t)}))})));case 14:t.prev=14,t.t0=t["catch"](7),o["a"].err("点赞失败："+t.t0);case 17:case"end":return t.stop()}}),t,null,[[7,14]])})));function e(e,n){return t.apply(this,arguments)}return e}(),removeStar:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(Promise){t.next=2;break}return t.abrupt("return");case 2:return e||(e=document.querySelector(".my--mingyan-name").innerText.trim()+"："+document.querySelector(".my--mingyan-text").innerText.trim()),t.prev=3,t.next=6,m();case 6:return n=t.sent,t.abrupt("return",new Promise((function(t,a){fetch(u,Object(r["a"])(Object(r["a"])({},i["c"]),{},{body:JSON.stringify({event:"removestar",data:{MY_text:e,MY_token:Object(o["f"])(),re_token:n,t:(new Date).getTime()}})})).then((function(t){return t.json()})).then((function(e){t(e)}))["catch"]((function(t){a(t)}))})));case 10:t.prev=10,t.t0=t["catch"](3),o["a"].err("点赞失败："+t.t0);case 13:case"end":return t.stop()}}),t,null,[[3,10]])})));function e(e){return t.apply(this,arguments)}return e}(),getRanking:function(){if(Promise)return new Promise((function(t,e){fetch(u,Object(r["a"])(Object(r["a"])({},i["c"]),{},{body:JSON.stringify({event:"ranking",data:{t:(new Date).getTime()}})})).then((function(t){return t.json()})).then((function(e){t(e)}))["catch"]((function(t){e(t)}))}))},getHistoryRanking:function(){if(Promise)return new Promise((function(t,e){fetch("https://www.erssmy.com/api/get-ranking-history?_t="+(new Date).getTime()).then((function(t){return t.json()})).then((function(n){Object(o["k"])(n),"请求成功"==n.msg&&t(n.data),e(n.msg)}))}))},update:function(t,e){if(Promise){t||e||(t=document.querySelector(".my--mingyan-name").innerText.trim()+"："+document.querySelector(".my--mingyan-text").innerText.trim());var n={};return e&&t&&(n={MY_text:t}),e&&!t&&(n={MY_ID:e}),!e&&t&&(n={MY_text:t}),new Promise((function(t,e){fetch(u,Object(r["a"])(Object(r["a"])({},i["c"]),{},{body:JSON.stringify({event:"update",data:Object(r["a"])(Object(r["a"])({},n),{},{MY_token:Object(o["f"])(),t:(new Date).getTime()})})})).then((function(t){return t.json()})).then((function(e){t(e)}))["catch"]((function(t){e(t)}))}))}}}}}]);